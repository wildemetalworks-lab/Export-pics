submitBtn.onclick = async () => {
    if (!seacanInput.value || !filesArray.length) {
        errorMsg.textContent = 'Seacan ID and at least one photo are required.';
        errorMsg.style.display = 'block';
        return;
    }

    submitBtn.disabled = true;
    errorMsg.textContent = 'Sending submission... Please wait.';
    errorMsg.style.color = '#3498db';
    errorMsg.style.display = 'block';

    try {
        // Convert files to EmailJS attachment objects
        const attachments = await Promise.all(
            filesArray.map(async (file, idx) => {
                const base64 = await fileToBase64(file);
                return {
                    name: file.name || `seacan-photo-${idx + 1}.jpg`,
                    data: base64,
                    type: file.type || 'image/jpeg'
                };
            })
        );

        const params = {
            seacan_id: seacanInput.value.trim().toUpperCase(),
            // Optional: if your template/service requires a specific 'to' email as a param
            // to_email: "your-recipient@example.com",  // ← add/change if needed
        };

        // Attach images as photo1 → photo5 (matches cid:photo1 etc. in template)
        attachments.slice(0, 5).forEach((att, i) => {
            params[`photo${i + 1}`] = att;
        });

        // Send with your real IDs
        await emailjs.send("service_kfwtc4b", "template_93bzhdh", params);

        // Success UI updates
        previewGrid.innerHTML = '';
        document.querySelector('.upload-area').style.display = 'none';
        seacanInput.disabled = true;
        fileInput.disabled = true;
        submitBtn.disabled = true;

        errorMsg.textContent = 'Submission sent successfully! Photos delivered via email.';
        errorMsg.style.color = '#27ae60';
        errorMsg.style.display = 'block';
    } catch (err) {
        console.error('EmailJS error details:', err);
        errorMsg.textContent = 'Failed to send email. ' + (err.text || err.message || 'Unknown error – check browser console.');
        errorMsg.style.color = '#e74c3c';
        errorMsg.style.display = 'block';
        submitBtn.disabled = false;
    }
};
